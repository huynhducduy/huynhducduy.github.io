function sendComment() {
  const t = $("#custom-comment-content").val();

  const e = $("#custom-comment-name").val();

  const m = $("#custom-comment-email").val();
  $.ajax({
    url: `${apiUrl}/api/comments`,
    type: "POST",
    data: JSON.stringify({
      Domain: domainName,
      Path: pathName,
      Content: t,
      Name: e,
      Email: m
    })
  })
    .done(() => {
      getComment(),
        $("#custom-comment-content").val(""),
        localStorage.setItem("name", e),
        localStorage.setItem("email", m);
    })
    .fail(() => {
      alert("Comment fail!!");
    });
}
function getComment() {
  $.get(`${apiUrl}/api/comments/${domainName}/${pathName}`, t => {
    const e = t.reverse();
    e.length
      ? ($("div.custom-comment-list").html(""),
        e.map(t => {
          $("div.custom-comment-list").append(
            `\n          <div class="custom-comment-element">\n            <div class="custom-comment-element-avatar">\n              <a href="#"><img src="http://avatars0.githubusercontent.com/u/0"></a>\n            </div>\n            <div class="custom-comment-element-content">\n              <div class="custom-comment-element-header">\n                <a href="mailto:${
              t.email
            }"><span class="custom-comment-element-author">${
              t.name
            }</span></a> wrote on ${t.createdAt
              .replace("Z", " ")
              .replace(
                "T",
                " "
              )}\n              </div>\n              <div class="custom-comment-element-body">\n                ${
              t.content
            }\n              </div>\n            </div>\n          </div>\n        `
          );
        }))
      : $("div.custom-comment-list").html("No comment.");
  });
}
function checkUserLogged() {
  localStorage.name &&
    localStorage.email &&
    ($("#custom-comment-name").val(localStorage.name),
    $("#custom-comment-email").val(localStorage.email),
    $("#custom-comment-name").hide(),
    $("#custom-comment-email").hide(),
    $("#custom-comment-button").html(`Comment via ${localStorage.name}`),
    $(".custom-comment-holder-info").html(
      `You're logged in with <strong>${localStorage.email}</strong>`
    ));
}
function initHTML() {
  $("head").append(
    `<link rel="stylesheet" href="//mrhmt.com/custom-comment/custom-comment.css">`
  ),
    $("#custom-comment-box").append(
      `\n  <div class="custom-comment-headline">\n    Comment Box\n  </div>\n  <div class="custom-comment-description">\n    I strongly recommended you to keep your keyboard and surf as fast as possible through this area.\n  </div>\n\n  <div class="custom-comment-holder">\n    <div class="custom-comment-holder-avatar">\n      <img id="login-avatar" src="http://avatars0.githubusercontent.com/u/0">\n    </div>\n    <div class="custom-comment-holder-input">\n      <input type="text" name="name" id="custom-comment-name" placeholder="Your Name" />\n      <input type="email" name="email" id="custom-comment-email" placeholder="name@company.com" />\n      <textarea id="custom-comment-content" rows="3" placeholder="Write something for me"></textarea>\n\n      <div class="custom-comment-holder-action">\n        <div class="custom-comment-holder-info">Enter your name and email only once.</div>\n        <button id="custom-comment-button" class="custom-comment-button" onclick="sendComment();">Give a comment</button>\n      </div>\n    </div>\n  </div>\n\n  <div class="custom-comment-list">\n    No comment.\n  </div>\n  `
    );
}
function init() {
  initHTML(), checkUserLogged(), getComment();
}
var apiUrl = "http://lab.mrhmt.com";

var domainName = window.location.hostname;

var pathName = window.location.pathname.replace(/\//g, "");
$(document).ready(init());
