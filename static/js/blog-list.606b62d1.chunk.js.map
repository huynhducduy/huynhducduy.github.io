{"version":3,"sources":["app/blog/read.js","utils/router/routeToUrl.js","app/blog/Post.js","app/blog/list.js","utils/api/caller.js"],"names":["BlogRead","match","history","useHistory","useState","post","setPost","load","useCallback","request","method","to","config","api","params","id","then","res","data","edit","push","del","useEffect","className","src","image","alt","title","user","name","created_at","formatRelative","fromUnixTime","Date","now","description","source","content","tags","split","map","tag","href","variant","isAuthenticated","style","float","onClick","pathToRegexp","compile","getRoute","path","React","memo","time","author","Number","isInteger","Row","Col","lg","md","xs","backgroundImage","routeToUrl","BlogList","posts","setPosts","last","setLast","hasMore","setHasMore","loadMore","axios","get","cursor","p","concat","length","marginBottom","Button","clearAuth","go","Post","timeout","defaultHeaders","headers","access_token","authHelpers","Authorization","a","custom","url"],"mappings":"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","file":"static/js/blog-list.606b62d1.chunk.js","sourcesContent":["import React, { useState, useEffect, useCallback } from 'react';\nimport './read.scss';\nimport { Row, Col, Badge, Button } from 'react-bootstrap';\nimport config from '../../config';\nimport formatRelative from 'date-fns/formatRelative';\nimport fromUnixTime from 'date-fns/fromUnixTime';\nimport { request } from 'utils/api/caller';\nimport { useHistory } from 'react-router-dom';\nimport isAuthenticated from 'utils/auth/isAuthenticated';\nimport ReactMarkdown from 'react-markdown';\n\nexport default function BlogRead({ match }) {\n  const history = useHistory();\n  const [post, setPost] = useState({});\n\n  const load = useCallback(\n    function () {\n      request({\n        method: 'GET',\n        to: config.api + '/blog/' + match.params.id,\n      }).then(function (res) {\n        setPost(res.data);\n      });\n    },\n    [match.params.id]\n  );\n\n  const edit = useCallback(\n    function () {\n      history.push('/blog/' + match.params.id + '/edit');\n    },\n    [history, match.params.id]\n  );\n\n  const del = useCallback(\n    function () {\n      request({\n        method: 'DELETE',\n        to: config.api + '/blog/' + match.params.id,\n      }).then(function (res) {\n        history.push('/blog');\n      });\n    },\n    [history, match.params.id]\n  );\n\n  useEffect(() => {\n    load();\n  }, [load]);\n\n  return (\n    <Row>\n      <Col>\n        <div className=\"blog-post\">\n          <div className=\"image\">\n            <img src={post.image} alt={post.title} />\n          </div>\n          <div className=\"title\">{post.title}</div>\n          <div className=\"author\">{post.user?.name}</div>\n          <div className=\"time\">\n            {post.created_at &&\n              formatRelative(fromUnixTime(post.created_at), Date.now())}\n          </div>\n          <div className=\"description\">{post.description}</div>\n          <div className=\"content\">\n            <ReactMarkdown source={post.content} />\n          </div>\n          <div className=\"tags\">\n            {post.tags &&\n              post.tags.split(',').map(tag => (\n                <>\n                  <a href={'/#/tag/' + tag}>\n                    <Badge variant=\"light\">{tag}</Badge>\n                  </a>\n                  &nbsp;\n                </>\n              ))}\n          </div>\n        </div>\n        {isAuthenticated() && (\n          <div style={{ float: 'right' }}>\n            <Button onClick={edit}>Edit</Button>&nbsp;\n            <Button onClick={del}>Delete</Button>\n          </div>\n        )}\n      </Col>\n    </Row>\n  );\n}\n","import pathToRegexp from 'path-to-regexp';\nimport getRoute from './getRoute';\n\nexport default function (name, data = {}) {\n  return pathToRegexp.compile(getRoute(name).path)(data);\n}\n","import React from 'react';\n\nimport { Row, Col } from 'react-bootstrap';\nimport formatRelative from 'date-fns/formatRelative';\nimport fromUnixTime from 'date-fns/fromUnixTime';\nimport { Link } from 'react-router-dom';\n\nimport routeToUrl from 'utils/router/routeToUrl';\n\nexport default React.memo(function ({\n  id = 0,\n  image,\n  title,\n  time = 0,\n  description,\n  author = {},\n}) {\n  if (!Number.isInteger(time)) time = 0;\n\n  return (\n    <div className=\"post\">\n      <Row>\n        <Col\n          lg={4}\n          md={12}\n          xs={5}\n          className=\"thumbnail\"\n          style={{\n            backgroundImage: \"url('\" + image + \"')\",\n          }}\n        ></Col>\n        <Col className=\"content\">\n          <h2 className=\"title\">\n            <Link to={routeToUrl('blog-read', { id })}>{title}</Link>\n          </h2>\n          <p className=\"description\">{description}</p>\n          <div>\n            <Link to={routeToUrl('user-read', { id })} className=\"author\">\n              {author.name}\n            </Link>\n            <br />\n            <span className=\"time\">\n              {formatRelative(fromUnixTime(time), Date.now())}\n            </span>\n          </div>\n        </Col>\n      </Row>\n    </div>\n  );\n});\n","import React, { useState, useEffect, useCallback } from 'react';\n\nimport { Row, Col, Button } from 'react-bootstrap';\nimport './list.scss';\nimport Post from './Post';\nimport axios from 'axios';\nimport { Link, useHistory } from 'react-router-dom';\nimport isAuthenticated from 'utils/auth/isAuthenticated';\nimport clearAuth from 'utils/auth/clearAuth';\n\nimport config from '../../config';\n\nexport default function BlogList() {\n  const history = useHistory();\n  const [posts, setPosts] = useState([]);\n  const [last, setLast] = useState(0);\n  const [hasMore, setHasMore] = useState(false);\n\n  const loadMore = useCallback(\n    function () {\n      axios\n        .get(config.api + '/blog', { params: { cursor: last } })\n        .then(function (res) {\n          setPosts(p => p.concat(res.data));\n          if (res.data.length > 0) {\n            setLast(res.data[res.data.length - 1].id);\n            setHasMore(true);\n          } else {\n            setHasMore(false);\n          }\n        });\n    },\n    [last]\n  );\n\n  useEffect(loadMore, []);\n\n  return (\n    <>\n      <Row>\n        <Col>\n          {isAuthenticated() ? (\n            <>\n              <div style={{ float: 'right', marginBottom: 20 }}>\n                <Button\n                  onClick={() => {\n                    clearAuth();\n                    history.go(0);\n                  }}\n                >\n                  Logout\n                </Button>\n                &nbsp;\n                <Link to=\"/blog/write\">\n                  <Button>Write</Button>\n                </Link>\n              </div>\n            </>\n          ) : (\n            <>\n              <div style={{ float: 'right', marginBottom: 20 }}>\n                <Link to=\"/auth/login\">\n                  <Button>Login</Button>\n                </Link>\n                &nbsp;\n                <Link to=\"/auth/register\">\n                  <Button>Register</Button>\n                </Link>\n              </div>\n            </>\n          )}\n        </Col>\n      </Row>\n      <Row className=\"blog\">\n        <Col lg={12} md={6}>\n          {posts.map(post => (\n            <Post\n              id={post.id}\n              image={post.image}\n              title={post.title}\n              time={post.created_at}\n              description={post.description}\n              author={post.user}\n            />\n          ))}\n          {hasMore ? (\n            <a alt=\"load more blog\" onClick={loadMore} href=\"javascript:\">\n              Load more...\n            </a>\n          ) : (\n            'No more blog...'\n          )}\n        </Col>\n      </Row>\n    </>\n  );\n}\n","import axios from 'axios';\nimport * as authHelpers from '../auth';\n\nconst config = {\n  timeout: 0,\n};\n\nfunction defaultHeaders() {\n  const headers = {};\n\n  headers['Content-Type'] = 'application/json';\n\n  const access_token = authHelpers.getAccessToken();\n  if (access_token !== null && !authHelpers.tokenIsExpired())\n    headers.Authorization = `Bearer ${access_token}`;\n\n  return headers;\n}\n\nexport async function request({\n  to,\n  method = 'GET',\n  data = {},\n  params = {},\n  headers = {},\n  custom,\n}) {\n  if (authHelpers.tokenIsAlmostExpired() || !authHelpers.getAccessToken()) {\n    if (!authHelpers.getRefreshToken()) authHelpers.clearAuth();\n    // else\n    // refresh token right before request\n    // await refreshToken().then((data) => {\n    //     setAuth();\n    // }).catch( () => {\n    //     authHelpers.clearAuth();\n    // })\n  }\n\n  return axios({\n    headers: { ...defaultHeaders(), ...headers },\n    url: to,\n    method,\n    data,\n    params,\n    config,\n    ...custom,\n  });\n}\n\nexport function Get({ to, data = {}, params = {}, headers = {} }) {\n  return request({\n    to,\n    method: 'GET',\n    data,\n    params,\n    headers,\n  });\n}\n\nexport function Post({ to, data = {}, params = {}, headers = {} }) {\n  return request({\n    to,\n    method: 'POST',\n    data,\n    params,\n    headers,\n  });\n}\n\nexport function Put({ to, data = {}, params = {}, headers = {} }) {\n  return request({\n    to,\n    method: 'PUT',\n    data,\n    params,\n    headers,\n  });\n}\n\nexport function Patch({ to, data = {}, params = {}, headers = {} }) {\n  return request({\n    to,\n    method: 'PATCH',\n    data,\n    params,\n    headers,\n  });\n}\n\nexport function Options({ to, data = {}, params = {}, headers = {} }) {\n  return request({\n    to,\n    method: 'OPTIONS',\n    data,\n    params,\n    headers,\n  });\n}\n\nexport function Head({ to, data = {}, params = {}, headers = {} }) {\n  return request({\n    to,\n    method: 'HEAD',\n    data,\n    params,\n    headers,\n  });\n}\n\nexport function Delete({ to, data = {}, params = {}, headers = {} }) {\n  return request({\n    to,\n    method: 'DELETE',\n    data,\n    params,\n    headers,\n  });\n}\n"],"sourceRoot":""}